<div class="admin-container">
  <h2>Administración de invitados</h2>
  <form [formGroup]="form" (ngSubmit)="addGuest()" class="admin-form-flex mb-4">
    <div class="admin-form-label">
      <label for="name" class="form-label w-100">Nombre del invitado:</label>
    </div>
    <div class="admin-form-input">
      <input id="name" formControlName="name" required class="form-control" />
    </div>
    <div class="admin-form-label">
      <label for="foto" class="form-label w-100">URL de la foto:</label>
    </div>
    <div class="admin-form-input">
      <input
        id="foto"
        formControlName="foto"
        type="url"
        placeholder="https://ejemplo.com/foto.jpg"
        class="form-control"
      />
    </div>
    <div class="admin-form-button">
      <button
        type="submit"
        class="btn btn-primary w-100"
        [disabled]="form.invalid"
      >
        Agregar invitado
      </button>
    </div>
  </form>
  <div *ngIf="success" class="success">{{ success }}</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <hr />
  <h3>Lista de invitados</h3>
  <div class="stats">
    <span><b>Total asistentes confirmados:</b> {{ totalAttendees }}</span>
    <span><b>No confirmados:</b> {{ notConfirmed }}</span>
  </div>
  <div *ngIf="loading">Cargando invitados...</div>
  <div class="table-responsive">
    <table *ngIf="guests.length" class="table table-striped align-middle">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Foto</th>
          <th>Token</th>
          <th>Link</th>
          <th>Confirmado</th>
          <th>Asistentes</th>
          <th>Fecha confirmación</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let guest of guests">
          <td>{{ guest.name }}</td>
          <td>
            <img
              *ngIf="guest.foto"
              [src]="guest.foto"
              alt="Foto de {{ guest.name }}"
              style="
                width: 50px;
                height: 50px;
                object-fit: cover;
                border-radius: 50%;
              "
            />
            <span *ngIf="!guest.foto">Sin foto</span>
          </td>
          <td>{{ guest.token }}</td>
          <td>
            <a [href]="'/confirmar/' + guest.token" target="_blank"
              >Abrir link</a
            >
          </td>
          <td>{{ guest.confirmed ? "Sí" : "No" }}</td>
          <td>{{ guest.attendees || 0 }}</td>
          <td>
            {{
              guest.confirmationDate
                ? (guest.confirmationDate | date : "dd/MM/yyyy HH:mm")
                : "-"
            }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
