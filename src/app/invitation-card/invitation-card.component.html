<div *ngIf="loading">Cargando invitaci贸n...</div>
<div *ngIf="error" class="error">{{ error }}</div>
<div
  class="container"
  (click)="!showConfirmation && flip()"
  *ngIf="!loading && !error"
>
  <div
    #invitation
    id="invitation"
    [class.flip-out]="isFlippingOut"
    [class.flip-in]="isFlippingIn"
  >
    <!-- 1) Imagen y overlay -->
    <img
      *ngIf="toggled"
      #invitationImg
      [src]="imageURL"
      alt="Invitaci贸n de cumplea帽os"
      (load)="onImgLoad()"
    />
    <div *ngIf="toggled" class="overlay animate__animated animate__flipInX">
      {{ userName }}
    </div>

    <!-- 2) Placeholder con texto y botones -->
    <div class="birthday-card" *ngIf="!toggled && !showConfirmation">
      <div class="lights"></div>
      <div class="card-content">
        <div class="main-content">
          <h1 class="name">Fer</h1>
          <p class="is-turning">Est谩 cumpliendo a帽os</p>
          <p class="invitation-text">ACOMPANOS A CELEBRAR</p>
        </div>

        <div class="event-info">
          <div class="event-details">
            <div class="detail-item">
              <p class="day">Viernes</p>
              <p class="time">7:00 pm</p>
            </div>
            <div class="date-number-container">
              <p class="date-number">01</p>
            </div>
            <div class="detail-item">
              <p class="month">Agosto</p>
              <p class="year">2025</p>
            </div>
          </div>

          <div class="location">
            <p class="address-title">Direcci贸n</p>
            <p class="address-details">Sal贸n social Conjunto Bioma</p>
          </div>
          <div class="event-note">
             Tu copa, tu estilo: trae el trago que m谩s te guste para
            compartir.
          </div>
          <p class="cheers-text">隆Te esperamos..!</p>
        </div>

        <div class="buttons-container">
          <a href="#" class="btn location-btn">
            <span class="icon-location"></span> VER UBICACIN
          </a>
          <button
            (click)="showConfirm(); $event.stopPropagation()"
            class="btn rsvp-btn"
          >
            <span class="icon-confirm"></span> CONFIRMAR ASISTENCIA
          </button>
        </div>
      </div>
    </div>
    <!-- 3) Pantalla de confirmaci贸n -->
    <div class="confirm-page" *ngIf="showConfirmation && !toggled">
      <div class="confirm-content">
        <div class="welcome-message">
          <p class="greeting-text">
            <span class="guest-name">{{ guestName }}</span
            >!
          </p>
          <p class="message-text" *ngIf="!confirmed">
            Tu asistencia para m铆, es el mejor regalo
          </p>
          <p class="action-text" *ngIf="!confirmed">Vamos a confirmar...</p>
        </div>

        <form
          [formGroup]="confirmForm"
          (ngSubmit)="submitConfirmation()"
          *ngIf="!confirmed"
          class="confirm-form-flex needs-validation"
        >
          <div class="confirm-form-block">
            <label for="confirmed" class="form-label">驴Vas a asistir?</label>
            <select
              id="confirmed"
              formControlName="confirmed"
              required
              class="form-select"
            >
              <option [ngValue]="true">S铆, asistir茅</option>
              <option [ngValue]="false">No podr茅 asistir</option>
            </select>
            <div
              *ngIf="
                confirmForm.get('confirmed')?.invalid &&
                confirmForm.get('confirmed')?.touched
              "
              class="invalid-feedback d-block"
            >
              Debes seleccionar una opci贸n.
            </div>
          </div>
          <div class="confirm-form-block">
            <label for="attendees" class="form-label"
              >驴Cu谩ntas personas asistir谩n contigo?</label
            >
            <input
              id="attendees"
              type="number"
              formControlName="attendees"
              min="1"
              required
              class="form-control"
              [class.disabled-field]="
                confirmForm.get('confirmed')?.value === false
              "
            />
            <div
              *ngIf="
                confirmForm.get('attendees')?.invalid &&
                confirmForm.get('attendees')?.touched &&
                confirmForm.get('confirmed')?.value !== false
              "
              class="invalid-feedback d-block"
            >
              Debe ser al menos 1 persona.
            </div>
            <div
              *ngIf="confirmForm.get('confirmed')?.value === false"
              class="field-note"
            >
              Si cambias de opini贸n, puedes confirmar m谩s tarde! 
            </div>
          </div>
        </form>

        <div *ngIf="success" class="success">{{ success }}</div>
        <div *ngIf="error" class="error">{{ error }}</div>
      </div>

      <div class="confirm-buttons">
        <div *ngIf="!confirmed" class="buttons-container">
          <button type="button" (click)="goBack()" class="btn btn-secondary">
            <span class="icon-back"></span> Volver
          </button>
          <button
            type="button"
            class="btn btn-primary"
            [disabled]="confirmForm.invalid"
            (click)="submitConfirmation()"
          >
            {{ confirmButtonText }}
          </button>
        </div>

        <div *ngIf="confirmed" class="buttons-container">
          <button type="button" (click)="goBack()" class="btn btn-secondary">
            <span class="icon-back"></span> Volver a la invitaci贸n
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
