<div *ngIf="loading">Cargando invitaci√≥n...</div>
<div *ngIf="error" class="error">{{ error }}</div>
<div class="container" (click)="!showConfirmation && flip()" *ngIf="!loading && !error">
  <div
    #invitation
    id="invitation"
    [class.flip-out]="isFlippingOut"
    [class.flip-in]="isFlippingIn"
  >
    <!-- 1) Imagen y overlay -->
    <img
      *ngIf="toggled"
      #invitationImg
      [src]="imageURL"
      alt="Invitaci√≥n de cumplea√±os"
      (load)="onImgLoad()"
    />
    <div *ngIf="toggled" class="overlay animate__animated animate__flipInX">
      {{ userName }}
    </div>

    <!-- 2) Placeholder con texto y botones -->
    <div class="birthday-card" *ngIf="!toggled && !showConfirmation">
      <div class="lights"></div>
      <div class="card-content">
        <div class="main-content">
          <h1 class="name">Fer</h1>
          <p class="is-turning">Est√° cumpliendo a√±os</p>
          <p class="invitation-text">ACOMP√Å√ëANOS A CELEBRAR</p>
        </div>

        <div class="event-info">
          <div class="event-details">
            <div class="detail-item">
              <p class="day">S√°bado</p>
              <p class="time">7:00 pm</p>
            </div>
            <div class="date-number-container">
              <p class="date-number">01</p>
            </div>
            <div class="detail-item">
              <p class="month">Agosto</p>
              <p class="year">2025</p>
            </div>
          </div>

          <div class="location">
            <p class="address-title">Direcci√≥n</p>
            <p class="address-details">Sal√≥n social Conjunto Bioma</p>
          </div>
          <div class="event-note">
            ü•Ç Tu copa, tu estilo: trae el trago que m√°s te guste para
            compartir.
          </div>
        </div>

        <div class="buttons-container">
          <a href="#" class="btn location-btn">
            <span class="icon-location"></span> VER UBICACI√ìN
          </a>
          <button
            (click)="showConfirm(); $event.stopPropagation()"
            class="btn rsvp-btn"
          >
            <span class="icon-confirm"></span> CONFIRMAR ASISTENCIA
          </button>
        </div>
      </div>
      <div class="footer-image">
        <p class="cheers-text">¬°Te esperamos..!</p>
      </div>
    </div>
    <!-- 3) Pantalla de confirmaci√≥n -->
    <div class="confirm-page" *ngIf="showConfirmation && !toggled">
      <p class="welcome-text">
        ¬°Hola {{ guestName }}! Tu asistencia para m√≠, es el mejor regalo: Vamos a confirmar...
      </p>

      <form
        [formGroup]="confirmForm"
        (ngSubmit)="submitConfirmation()"
        *ngIf="!confirmed"
        class="confirm-form-flex needs-validation"
      >
        <div class="confirm-form-block">
          <label for="confirmed" class="form-label">¬øVas a asistir?</label>
          <select
            id="confirmed"
            formControlName="confirmed"
            required
            class="form-select"
          >
            <option [ngValue]="true">S√≠, asistir√©</option>
            <option [ngValue]="false">No podr√© asistir</option>
          </select>
          <div
            *ngIf="
              confirmForm.get('confirmed')?.invalid &&
              confirmForm.get('confirmed')?.touched
            "
            class="invalid-feedback d-block"
          >
            Debes seleccionar una opci√≥n.
          </div>
        </div>
        <div class="confirm-form-block">
          <label for="attendees" class="form-label"
            >¬øCu√°ntas personas asistir√°n contigo?</label
          >
          <input
            id="attendees"
            type="number"
            formControlName="attendees"
            min="1"
            required
            class="form-control"
            [class.disabled-field]="
              confirmForm.get('confirmed')?.value === false
            "
          />
          <div
            *ngIf="
              confirmForm.get('attendees')?.invalid &&
              confirmForm.get('attendees')?.touched &&
              confirmForm.get('confirmed')?.value !== false
            "
            class="invalid-feedback d-block"
          >
            Debe ser al menos 1 persona.
          </div>
          <div
            *ngIf="confirmForm.get('confirmed')?.value === false"
            class="field-note"
          >
            Si cambias de opini√≥n, puedes confirmar m√°s tarde! üòâ
          </div>
        </div>
        <div class="confirm-form-block">
          <button
            type="submit"
            class="btn btn-primary w-100"
            [disabled]="confirmForm.invalid"
          >
            Confirmar
          </button>
        </div>
        <div class="confirm-form-block">
          <button
            type="button"
            (click)="goBack()"
            class="btn btn-secondary w-100"
          >
            <span class="icon-back"></span> Volver
          </button>
        </div>
      </form>

      <div *ngIf="success" class="success">{{ success }}</div>
      <div *ngIf="error" class="error">{{ error }}</div>
      <div *ngIf="confirmationDate" class="confirmation-date">
        Confirmado el {{ confirmationDate }}
      </div>

      <div *ngIf="confirmed" class="confirm-form-flex">
        <button
          type="button"
          (click)="goBack()"
          class="btn btn-secondary w-100"
        >
          <span class="icon-back"></span> Volver a la invitaci√≥n
        </button>
      </div>
    </div>
  </div>
</div>
